<!doctype html>
<html>
  <head>
    <title>Demo 1: Elterngeld beantragen</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#">
    <style>
      html * {
        font-family: Arial, serif;
      }
      .input-field {
        width: 210px;
      }
    </style>
  </head>
  <body>
    <h2 id="headline">Formular f√ºr: Elterngeld beantragen</h2>
    <br><br><br>
    <form>
      <label for="firstName">Vorname</label><br>
      <input type="text" id="firstName" class="input-field"><br><br>

      <label for="lastName">Nachname</label><br>
      <input type="text" id="lastName" class="input-field"><br><br>

      <label for="birthday">Geburtstag</label><br>
      <input type="text" id="birthday" class="input-field"><br><br>

      <label for="birthplace">Geburtsort</label><br>
      <input type="text" id="birthplace" class="input-field"><br><br>

      <label for="maritalStatus">Familienstand</label><br>
      <input type="text" id="maritalStatus" class="input-field"><br><br>

      <label for="insuranceNumber">Versichertennummer</label><br>
      <input type="text" id="insuranceNumber" class="input-field"><br><br>

      <label for="rentInsuranceNumber">Rentenversicherungsnummer</label><br>
      <input type="text" id="rentInsuranceNumber" class="input-field"><br><br>

      <label for="identityNumber">Personalausweisnummer</label><br>
      <input type="text" id="identityNumber" class="input-field"><br><br>

      <label for="taxId">Steueridentifikationsnummer</label><br>
      <input type="text" id="taxId" class="input-field">

      <br><br><br><br>
      <input type="submit" value="Formular einreichen">
      <input type="submit" id="downloadGraphBtn" value="Graph herunterladen" style="background-color: yellow;">
    </form>
    <script src="node_modules/rdflib/dist/rdflib.min.js"></script>
    <script>
      const rdflib = $rdf;
      const baseUri = "http://onto.de/default#";

      document.getElementById("headline").addEventListener("click", function(event) {
        document.getElementById("downloadGraphBtn").style.display = "inline";
      });

      function namedNode(localName) {
          return rdflib.namedNode(baseUri + localName);
      }

      function statement(sub, pred, obj, isLiteral) {
        return rdflib.st(namedNode(sub), namedNode(pred),
            isLiteral ? rdflib.literal(obj) : namedNode(obj));
      }

      function downloadTurtleFile(filename, content) {
        let blob = new Blob([content], { type: 'text/turtle' });
        let url = URL.createObjectURL(blob);
        let link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.setAttribute('Content-Type', 'text/turtle');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      document.getElementById("downloadGraphBtn").addEventListener("click", function(event) {
        event.preventDefault();
        const store = rdflib.graph();
        store.add(statement("mainPerson", "firstName", document.getElementById("firstName").value, true));
        store.add(statement("mainPerson", "lastName", document.getElementById("lastName").value, true));
        store.add(statement("mainPerson", "birthday", document.getElementById("birthday").value, true));
        store.add(statement("mainPerson", "birthplace", document.getElementById("birthplace").value, true));
        store.add(statement("mainPerson", "maritalStatus", document.getElementById("maritalStatus").value, true));
        store.add(statement("mainPerson", "insuranceNumber", document.getElementById("insuranceNumber").value, true));
        store.add(statement("mainPerson", "rentInsuranceNumber", document.getElementById("rentInsuranceNumber").value, true));
        store.add(statement("mainPerson", "identityNumber", document.getElementById("identityNumber").value, true));
        store.add(statement("mainPerson", "taxId", document.getElementById("taxId").value, true));
        const turtle = rdflib.serialize(undefined, store, undefined, 'text/turtle');
        downloadTurtleFile("elterngeld.ttl", turtle);
      });
    </script>
  </body>
</html>
