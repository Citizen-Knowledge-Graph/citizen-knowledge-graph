<!doctype html>
<html>
  <head>
    <title>Demo 1: Elterngeld beantragen</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#">
    <style>
      html * {
        font-family: Arial, serif;
      }
      .input-field {
        width: 210px;
      }
    </style>
  </head>
  <body>
    <h2 id="headline">Formular f√ºr: Elterngeld beantragen</h2>
    <br><br><br>
    <form>
      <label for="fname">Vorname</label><br>
      <input type="text" id="fname" class="input-field"><br><br>

      <label for="lname">Nachname</label><br>
      <input type="text" id="lname" class="input-field"><br><br>

      <label for="bday">Geburtstag</label><br>
      <input type="text" id="bday" class="input-field"><br><br>

      <label for="bday-loc">Geburtsort</label><br>
      <input type="text" id="bday-loc" class="input-field"><br><br>

      <label for="marital-status">Familienstand</label><br>
      <input type="text" id="marital-status" class="input-field"><br><br>

      <label for="insurance-num">Versichertennummer</label><br>
      <input type="text" id="insurance-num" class="input-field"><br><br>

      <label for="rent-insurance-num">Rentenversicherungsnummer</label><br>
      <input type="text" id="rent-insurance-num" class="input-field"><br><br>

      <label for="perso-num">Personalausweisnummer</label><br>
      <input type="text" id="perso-num" class="input-field"><br><br>

      <label for="taxid">Steueridentifikationsnummer</label><br>
      <input type="text" id="taxid" class="input-field">

      <br><br><br><br>
      <input type="submit" value="Formular einreichen">
      <input type="submit" id="downloadGraphBtn" value="Graph herunterladen" style="background-color: yellow;">
    </form>
    <script src="node_modules/rdflib/dist/rdflib.min.js"></script>
    <script>
      const rdflib = $rdf;
      const baseUri = "http://onto.de/default#";

      document.getElementById("headline").addEventListener("click", function(event) {
        document.getElementById("downloadGraphBtn").style.display = "inline";
      });

      function namedNode(localName) {
          return rdflib.namedNode(baseUri + localName);
      }

      function statement(sub, pred, obj, isLiteral) {
        return rdflib.st(namedNode(sub), namedNode(pred),
            isLiteral ? rdflib.literal(obj) : namedNode(obj));
      }

      function downloadTurtleFile(filename, content) {
        let blob = new Blob([content], { type: 'text/turtle' });
        let url = URL.createObjectURL(blob);
        let link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.setAttribute('Content-Type', 'text/turtle');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      document.getElementById("downloadGraphBtn").addEventListener("click", function(event) {
        event.preventDefault();
        const store = rdflib.graph();
        store.add(statement("mainPerson", "firstName", document.getElementById("fname").value, true));
        store.add(statement("mainPerson", "lastName", document.getElementById("lname").value, true));
        store.add(statement("mainPerson", "birthday", document.getElementById("bday").value, true));
        store.add(statement("mainPerson", "birthplace", document.getElementById("bday-loc").value, true));
        store.add(statement("mainPerson", "maritalStatus", document.getElementById("marital-status").value, true));
        store.add(statement("mainPerson", "insuranceNumber", document.getElementById("insurance-num").value, true));
        store.add(statement("mainPerson", "rentInsuranceNumber", document.getElementById("rent-insurance-num").value, true));
        store.add(statement("mainPerson", "identityNumber", document.getElementById("perso-num").value, true));
        store.add(statement("mainPerson", "taxId", document.getElementById("taxid").value, true));
        const turtle = rdflib.serialize(undefined, store, undefined, 'text/turtle');
        downloadTurtleFile("elterngeld.ttl", turtle);
      });
    </script>
  </body>
</html>
