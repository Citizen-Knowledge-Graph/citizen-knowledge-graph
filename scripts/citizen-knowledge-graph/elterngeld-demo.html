<!doctype html>
<html>
  <head>
    <title>Demo 1: Elterngeld beantragen</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#">
    <style>
      html * {
        font-family: Arial, serif;
      }
      .input-field {
        width: 210px;
      }
    </style>
  </head>
  <body>
    <h2 id="headline">Formular für: Elterngeld beantragen</h2>
    <br><br>
    <form>
      <label for="firstName">Vorname</label><br>
      <input type="text" id="firstName" class="input-field"><br><br>

      <label for="lastName">Nachname</label><br>
      <input type="text" id="lastName" class="input-field"><br><br>

      <label for="birthday">Geburtstag</label><br>
      <input type="text" id="birthday" class="input-field"><br><br>

      <label for="birthplace">Geburtsort</label><br>
      <input type="text" id="birthplace" class="input-field"><br><br>

      <label for="maritalStatus">Familienstand</label><br>
      <input type="text" id="maritalStatus" class="input-field"><br><br>

      <label for="insuranceNumber">Versichertennummer</label><br>
      <input type="text" id="insuranceNumber" class="input-field"><br><br>

      <label for="rentInsuranceNumber">Rentenversicherungsnummer</label><br>
      <input type="text" id="rentInsuranceNumber" class="input-field"><br><br>

      <label for="identityNumber">Personalausweisnummer</label><br>
      <input type="text" id="identityNumber" class="input-field"><br><br>

      <label for="taxId">Steueridentifikationsnummer</label><br>
      <input type="text" id="taxId" class="input-field">

      <br><br><br><br>
      <input type="submit" value="Formular einreichen">
      <span id="note" style="display: none">
        <input type="checkbox" id="addNote">
        <label for="addNote"><small>Notiz anhängen</small></label>
        &nbsp;
        <input type="text" id="addNoteInput" class="input-field" style="display: none; font-size: small">
      </span>
      <span id="graphBtns" style="display: none;">
        <input type="submit" id="downloadGraphBtn" value="Daten herunterladen" style="background-color: yellow;">
        <input type="submit" id="importGraphBtn" value="Daten importieren" style="background-color: yellow;"/>
      </span>
    </form>
    <script src="node_modules/rdflib/dist/rdflib.min.js"></script>
    <script src="./graph-utils.js"></script>
    <script>
      let headlineClickCounter = 0;

      document.getElementById("headline").addEventListener("click", function(event) {
        if (headlineClickCounter % 2 === 0) {
          document.getElementById("note").style.display = "none";
          document.getElementById("graphBtns").style.display = "inline";
        } else {
          document.getElementById("note").style.display = "inline";
          document.getElementById("graphBtns").style.display = "none";
        }
        headlineClickCounter ++;
      });

      function getFilledStore() {
        const store = createStore();
        store.add(statement("form-download-for-ckg", "hasTitle", "ElterngeldBeantragen", true));
        store.add(statement("form-download-for-ckg", "timestamp", getTimestamp(), true));
        store.add(statement("mainPerson", "firstName", document.getElementById("firstName").value, true));
        store.add(statement("mainPerson", "lastName", document.getElementById("lastName").value, true));
        store.add(statement("mainPerson", "birthday", document.getElementById("birthday").value, true));
        store.add(statement("mainPerson", "birthplace", document.getElementById("birthplace").value, true));
        store.add(statement("mainPerson", "maritalStatus", document.getElementById("maritalStatus").value, true));
        store.add(statement("mainPerson", "insuranceNumber", document.getElementById("insuranceNumber").value, true));
        store.add(statement("mainPerson", "rentInsuranceNumber", document.getElementById("rentInsuranceNumber").value, true));
        store.add(statement("mainPerson", "identityNumber", document.getElementById("identityNumber").value, true));
        store.add(statement("mainPerson", "taxId", document.getElementById("taxId").value, true));
        return store;
      }

      document.getElementById("downloadGraphBtn").addEventListener("click", function(event) {
        event.preventDefault();
        downloadAsTurtleFile(getFilledStore(), "Elterngeld.ttl");
      });

      document.getElementById("importGraphBtn").addEventListener("click", function(event) {
        event.preventDefault();
        let content = rdflib.serialize(undefined, getFilledStore(), undefined, 'text/turtle');
        window.open("ckg-app://import/" + encodeURIComponent(content), "_self");
      });

      document.getElementById("addNote").addEventListener('change', (event) => {
        if (event.currentTarget.checked) {
          document.getElementById("addNoteInput").style.display = "inline";
        }
      })
    </script>
  </body>
</html>
