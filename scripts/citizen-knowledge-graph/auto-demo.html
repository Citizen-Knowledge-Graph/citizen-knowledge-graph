<!doctype html>
<html>
<head>
  <title>Demo 2: Auto anmelden</title>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="#">
  <style>
    html * {
      font-family: Arial, serif;
    }
    .input-field {
      width: 210px;
    }
  </style>
</head>
<body>
  <h2 id="headline">Formular für: Auto anmelden</h2>
  <span id="span-before" style="background-color: yellow; display: none">
    Anfrage an Ihren Graphen nach passenden Daten &rarr;&nbsp;
    <a id="a-copy" href="#" onclick="copyQueryToClipboard()">kopiere Query </a>
    <img id="img-copy" src="files/copy-icon.png" width="14"/>
    <span id="span-result" style="display: none">&rarr;&nbsp;
      <a id="a-result" href="#" onclick="processQueryResult()">Ergebnis einlesen:</a>
      <img id="img-result" src="files/checkmark-icon.png" width="14" style="display: none"/>
      &nbsp;
      <textarea style="font-size: xx-small; color: gray" type="text" id="input-result"></textarea>
    </span>
  </span>
  <br><br><br>
  <form>
    <label for="firstName">Vorname</label><br>
    <input type="text" id="firstName" class="input-field"><br><br>

    <label for="lastName">Nachname</label><br>
    <input type="text" id="lastName" class="input-field"><br><br>

    <label for="birthday">Geburtstag</label><br>
    <input type="text" id="birthday" class="input-field"><br><br>

    <label for="age">Aktuelles Alter in Jahren</label><br>
    <input type="text" id="age" class="input-field"><br><br>

    <label for="birthplace">Geburtsort</label><br>
    <input type="text" id="birthplace" class="input-field"><br><br>

    <label for="gender">Geschlecht</label><br>
    <input type="text" id="gender" class="input-field"><br><br>

    <label for="eVBnumber">elektronische Versicherungsbestätigung (eVB-Nummer)</label><br>
    <input type="text" id="eVBnumber" class="input-field"><br><br>

    <label for="identityNumber">Personalausweisnummer</label><br>
    <input type="text" id="identityNumber" class="input-field"><br><br>

    <label for="perso">Ausweisdokument</label>
    <input type="file" id="perso" accept="image/*,.pdf"><br><br>
<!--
    <label for="zb1">Zulassungsbescheinigung Teil 1</label>
    <input type="file" id="zb1" accept="image/*,.pdf"><br><br>

    <label for="zb2">Zulassungsbescheinigung Teil 2</label>
    <input type="file" id="zb2" accept="image/*,.pdf"><br><br>

    <label for="hu">gültige Hauptuntersuchung (HU)</label>
    <input type="file" id="hu" accept="image/*,.pdf">
-->
    <br><br><br>
    <input type="submit" value="Formular einreichen">
  </form>
  <script src="node_modules/papaparse/papaparse.min.js"></script>
  <script>
    document.getElementById("headline").addEventListener("click", function(event) {
      document.getElementById("span-before").style.display = "inline";
    });

    function copyQueryToClipboard() {
      const query = "PREFIX : <http://onto.de/default#>\n"
          + "SELECT ?s ?p ?o WHERE { \n"
          + "  VALUES ?p { :firstName :lastName :birthday :birthplace :gender :eVBnumber :identityNumber }\n"
          + "  ?s ?p ?o .\n"
          + "}";
      navigator.clipboard.writeText(query);
      document.getElementById("a-copy").innerHTML = "Query kopiert ";
      document.getElementById("a-copy").style.textDecoration = "none";
      document.getElementById("img-copy").src = "files/checkmark-icon.png";
      document.getElementById("span-result").style.display = "inline";
    }

    function processQueryResult() {
      let pastedResult = document.getElementById("input-result").value;
      document.getElementById("a-result").innerHTML = "Ergebnis eingelesen";
      document.getElementById("a-result").style.textDecoration = "none";
      document.getElementById("input-result").style.display = "none";
      document.getElementById("img-result").style.display = "inline";
      const triples = Papa.parse(pastedResult.trim(), {
        transform: (value) => value.trim()
      }).data;
      for (let triple of triples) {
        let predicateLocalName = triple[1].split('#')[1];
        document.getElementById(predicateLocalName).value = triple[2];
      }
    }
  </script>
</body>
</html>
