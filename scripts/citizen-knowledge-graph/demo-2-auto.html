<!doctype html>
<html>
<head>
  <title>Demo 2: Auto anmelden</title>
  <meta charset="utf-8">
  <link rel="shortcut icon" href="#">
  <link href="main.css" rel="stylesheet" />
</head>
<body>
  <h2 id="headline">Formular für: Auto anmelden</h2>
  <input type="button" value="Anfrage an Ihren CKG nach passenden Daten"
         id="send-query-btn" style="background-color: yellow; display: none" />
  <br><br><br>
  <form>
    <label for="firstName">Vorname</label><br>
    <input type="text" id="firstName" class="input-field"><br><br>

    <label for="lastName">Nachname</label><br>
    <input type="text" id="lastName" class="input-field"><br><br>

    <label for="birthday">Geburtstag</label><br>
    <input type="text" id="birthday" class="input-field"><br><br>

    <label for="age">Aktuelles Alter in Jahren</label><br>
    <input type="text" id="age" class="input-field"><br><br>

    <label for="birthplace">Geburtsort</label><br>
    <input type="text" id="birthplace" class="input-field"><br><br>

    <label for="gender">Geschlecht</label><br>
    <input type="text" id="gender" class="input-field"><br><br>

    <label for="eVBnumber">elektronische Versicherungsbestätigung (eVB-Nummer)</label><br>
    <input type="text" id="eVBnumber" class="input-field"><br><br>

    <label for="identityNumber">Personalausweisnummer</label><br>
    <input type="text" id="identityNumber" class="input-field"><br><br>

    <label for="perso">Ausweisdokument</label>
    <input type="file" id="perso" accept="image/*,.pdf"><br><br>
<!--
    <label for="zb1">Zulassungsbescheinigung Teil 1</label>
    <input type="file" id="zb1" accept="image/*,.pdf"><br><br>

    <label for="zb2">Zulassungsbescheinigung Teil 2</label>
    <input type="file" id="zb2" accept="image/*,.pdf"><br><br>

    <label for="hu">gültige Hauptuntersuchung (HU)</label>
    <input type="file" id="hu" accept="image/*,.pdf">
-->
    <br><br><br>
    <input type="submit" value="Formular einreichen">
  </form>
  <script src="node_modules/querystringify/index.js"></script>
  <script src="./graph-utils.js"></script>
  <script>
    let encodedQueryParams = window.location.href.split('?')[1];
    if (encodedQueryParams) {
      let queryParams = querystring(encodedQueryParams);
      for (let key of Object.keys(queryParams)) {
        document.getElementById(key).value = queryParams[key];
      }
    }

    document.getElementById("headline").addEventListener("click", function(event) {
      document.getElementById("send-query-btn").style.display = "inline";
    });

    function deepLinkHandoverToElectronApp(message) {
      let url = "ckg-app://" + encodeURIComponent(JSON.stringify(message));
      window.open(url, "_self");
    }

    let btnClickCount = 0;

    document.getElementById("send-query-btn").addEventListener("click", function(event) {
      event.preventDefault();
      const query = "PREFIX : <http://onto.de/default#>\n"
          + "SELECT ?s ?p ?o WHERE { \n"
          + "  VALUES ?p { :firstName :lastName :birthday :birthplace :gender :eVBnumber :identityNumber }\n"
          + "  ?s ?p ?o .\n"
          + "}";
      if (btnClickCount % 2 === 0) {
        deepLinkHandoverToElectronApp({
          command: "fill",
          query: query,
          responseUrl: window.location.href
        });
      } else {
        download(query, "text/plain", "query.rq");
      }
      btnClickCount ++;
    });
  </script>
</body>
</html>
